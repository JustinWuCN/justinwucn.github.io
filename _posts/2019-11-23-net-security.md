---
layout: post
title: 网络安全 
date: 2019-11-08
categories: 家庭数据中心 
---

家庭数据中心已经初具雏形，在还没有完成基本框架的文档前，而安全问题已经凸显，因此先写一篇关于安全的问题。

### 数据中心的服务
数据中心，需要完成数据的进入，数据存储，数据读出这几大任务。 而如果要完成这些任务，则需要具有与其他计算机通信的能力。

对数据中心而言，图形界面的显示，键盘的输入则并不是必需。

因此，在数据中心里，需要提供大致如下的服务：

1. 安装ssh服务器，提供远程登录服务。
2. 安装ftp服务器，让远程计算机能够输入文件，读取文件。
3. 安装http服务器，提供网页的显示。
4. 如果需要进行开发，则git服务器也是需要安装的。

### 开放的服务，就会有人想进入。

数据中心的系统在安装了ssh服务之后，其他电脑就可以通过ssh协议登录进入数据中心中，进行数据操作。

然而，事物总分两面，开放了登录权限，方便了自己，也有可能被其他本来不想让他登录的人登录进来。

在数据中心安装完成，到上线服务短短二天时间，就发现有很多其他非授权的IP通过猜用户名的方式想要登入系统。

使用如下命令查看登录失败的用户，可以看到一个非常长的列表。
```
sudo lastb | head -n 10
```
从列表里看到登录的名字，IP地址，登录时间这几个信息，从登录时间来看，一分钟就尝试几次，应该是一个自动程序来破解密码。

用户名大多是"root", "admin","ftpadmin","server","master"之类的一些超级用户的名字。

### 如何防止非授权人进入系统？

有矛就有盾，事物之常理。既知敌之所攻，则知己之所守。 

从上面查看到的信息，可以得出对应的策略:

1. 关闭超级用户名。  
       像"root","admin"之类的名字，日常使用中就不应该使用。禁止这类用户名通过ssh登录。  


```
    #/etc/ssh/sshd_config
    PermitRootLogin no 	#禁止root用户登录
    MaxAuthTries 3		#最大尝试次数，看起来是同一个名字的最大尝试次数
```

2. 服务安装完后，创建的用户名不要用默认的密码。  
	像"oracle","ubuntu"，“nginx”这样的名字，如果能改名就把这些名字改掉，如果不能改掉，那一定要把密码修改掉，绝对不使用默认的密码。

3. 拒绝同一IP 进行多次登录尝试。
	一些黑客工具会使用一份长长的用户名密码列表，使用列表里的密码一个一个尝试，这就好比是一个小偷，带着一大堆钥匙，对着同一道门进行逐个尝试的破解方式。  
	针对这样的方式，服务器系统的开发者已经提供了一个非常好用的工具，叫__fail2ban__,即是在同一个IP多次登录失败后，就会对这个IP拒绝服务。  
	装上fail2ban之后，读文档可知， 需要进行一些设置:
```
	#/etc/fail2ban/jail.local
	[DEFAULT]
	#针对要ban的时间，默认是1h,但要想狠一点，把这个时间设为一天。
	bantime = 1d

	[sshd]
	#启动对sshd的监控
	enabled = true
```

	设置完后，重新启动ssh服务
```
	systemctl restart ssh
```

---

### 结语

现实之中，君子者众，门锁的设计为防君子不防小人，因居住地之附近君子多而小人少也。  
互联网上，龙蛇混杂，所面对的人群非常庞大，君子与小人也倍数增加，因此安全措施也要相应增加。

当然，道高一尺，魔高一丈，攻防战中，此消彼长，防不胜防。如果碰到高端黑客，总会在诸多安全漏洞中攻入系统。而这，只能祈祷系统开发人员开发出更多更安全的防护措施了。而我们，只能善用现有的安全措施，尽可能多的防止住入侵人群。



